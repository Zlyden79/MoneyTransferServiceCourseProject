# Курсовой проект [«Сервис перевода денег»](https://github.com/netology-code/jd-homeworks/blob/master/diploma/moneytransferservice.md)

## Rest-сервис 
Принимает запросы на 2 эндпоинта, на каждый эндпоинт - свои контроллер и сервис.
В программе используются 3 класса валидаторов.

## /transfer

* Контроллер MoneyTransferController
* Сервис MoneyTransferSerevice
* Валидаторы:
  * AmountValidator проверяет деньги (валюта и сумма)
  * CardValidator проверяет номера карт, срок их действия и CVV

Проверки:
* Номера карт проверяются на наличие 16 цифр и соответствие алгоритму Луна. 
* Карта отправителя и получателя не должны совпадать.
* CVV - три числовых символа.
* ValidTill - два числа (месяц), разделитель ' / ' и снова 2 числа (год без века). Месяц в диапазоне [01-12]. Сравнивается с текущим месяцем/годом, просрочка отвергается.
* Деньги (Amount) - валюта (Currency) только "RUR", сумма (Value) только из чисел и заканчивается двумя нулями (фронтенд так выдаёт).

## /confirmOperation
* Контроллер ConfirmOperationController
* Сервис ConfirmOperationSerevice
* Валидатор ConfirmOperationValidator

Проверки:
* operationId - проверяется на отсутствие вообще, пустую строку, строку из одних пробелов. В этих случаях отказ.
* code - обычно банки/сервисы присылают код подтверждения в виде 4-6 чисел. Вот и у меня проходят валидацию коды только из 4-6 чисел.

## Исключения

В проекте я задействовал 2 самописных исключения:
* Exception400 - выбрасывается сервисом, если провалилась валидация параметров.
* Exception500 - если бизнес-логика выдаёт отказ в операции.

За обработку исключений отвечает ExceptionHandlerAdvice, возвращая соответствующие HttpStatus и json. 

## Бизнес-логика

Так как я в мессенджере LOOP задавал вопросы и получил на них ответы, я понял, что мне не придётся писать репозитории с хранилищем карт, их балансов и делать проверки возможности перевода реальных денег(это когда сумма перевода меньше баланса на счету карты).
Поэтому бизнес-логика "имитирует" обращение к сторонним сервисам (например, банкам) и в случае валидных переметров запроса с вероятностью 1:5 выдаёт отказы в операциях, в остальных случаях - успех. 

## Тесты

* Валидаторы покрыты модульными тестами без заглушек.
* Сервисы покрыты модульными тестами с заглушками.
* Для интеграционного теста необходимо сбилдить контейнер командой ```docker build -t backend . ```

## Журналирование

За журналирование отвечает класс MyLogger. В журнал пишут методы сервиса и обработчик исключений.
Прочесть в контейнере можно командой ```cat ./moneytransferservice.log```